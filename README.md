# Архитектура компьютера. Практическое задание

![](fig/lab3-structure.png)

Проект/отчёт должен включать следующие элементы:

1. **Спецификация языка программирования**.

    - Описание [синтаксиса](https://ru.wikipedia.org/wiki/Синтаксис_(программирование)). Рекомендуется использовать [форму Бэкуса-Наура](https://ru.wikipedia.org/wiki/Форма_Бэкуса_—_Наура).
    - Описание [семантики](https://ru.wikipedia.org/wiki/Семантика_(программирование)). В первую очередь:
        - [стратегия вычислений](https://ru.wikipedia.org/wiki/Стратегия_вычисления),
        - [области видимости](https://ru.wikipedia.org/wiki/Область_видимости),
        - типизация.

2. **Транслятор**.

    - Является консольным приложением.
    - *Входные данные*: исходный код в текстовом виде (файл или стандартный ввод), аргументы командной строки (помощь, настройки).
    - *Выходные данные*: машинный код в виде файла для разработанной системы команд.
    - В отчёте необходимо диаграммой проиллюстрировать принципы работы. Привести ключевые элементы реализации.

3. **Спецификация системы команд**.

    - Машинное слово, адресация, типы, состав регистров и флагов, организация памяти, системы прерываний, ввода-вывода.

    - Структурированный вид -- система команд кодируется как плоская структура данных. Форма разрабатывается учащимся, приоритеты: читаемость машинного кода, удобство машинной обработки, стройность. Примеры:

        ```haskell
        data InstructionSet = Jmp Address
                            | Inc Register
                            | ...
        data MachineCode = MachineCode [InstructionSet]
        ```

        или

        ```json
        [
        {"mnemonic": "jmp", "address": <number>}
        | {"mnemonic": "inc", "register": <number>}
        | ...
        ]
        ```

        или

        ```python
        [("jmp", <number>) | ("jmp", <number>) | ...] 
        ```

    - Бинарный вид (если требуется) -- представление в виде последовательности байт. Реализуется в дополнение к структурированному виду для представления машинного кода. Код должен быть компактным.

4. **Модель процессора**.

    - Является консольным приложением.
    - *Входные данные*:
        - Машинный кода подаётся через файл. Представление определяется вариантом.
        - Ввод данных имитируется при помощи расписания изменения входов процессора. Примерный вид строки расписания: `(<номер-шага-моделирования>, <идентификатор-входа>, <установленное-значение>)`.
        - Настройки аннотированного журнала состояний передаются через параметры командной строки.
    - *Выходные данные*: аннотированный журнал состояний.
        - Включает:
            - выполненная инструкция / выполняемая инструкция / выполняемые инструкции;
            - выполняемый микрокод;
            - выполняемая [под]строка алгоритма на языке программирования;
            - состояние памяти и регистров;
            - состояние ввода/вывода;
            - состояние .
        - Возможный вариант: по тектовому файлу на каждый шаг моделирования, diff между двумя соседними файлами визуализирует вычислительный процесс.
    - В отчёте необходимо диаграммой проиллюстрировать принципы работы. Привести ключевые элементы реализации.

5. **Реализация алгоритма(-ов)**.

    - Реализация заданного алгоритма(-ов) на реализованом языке программирования.
    - В отчёте необходимо:
        - привести машинный код в структурированом виде (читаемое форматирование!);
        - анализ аннотированного журнала, на данных которого продемонстрировать особенности моделируемого процессора (если есть сторожевой таймер, показать как срабатывает; если конвейер, показать как он загружается / сбрасывается; и т.п.).

#### Варианты

Вариант определяется:

- комбинации особенностей реализации;
- реализуемым алгоритмом.

| Особенность              | 1.                 | 2.                  | 3.     | 4.   |
| ------------------------ | ------------------ | ------------------- | ------ | ---- |
| ЯП. Синтаксис похож на   | Java[Script]/C     | assembler           | forth  | lisp |
| ЯП. Процедуры            | нереентерабельные  | реентерабельные     | нет    |      |
| Проц. Поддержка стека    | есть               | нет                 |        |      |
| Организация памяти       | Принстонская       | Гарвардская         |        |      |
| Архитектура процессора   | CISC               | RISC                | Stack  |      |
| Внутреннее устройство    | microcode          | pipeline            | tagged | нет  |
| Представление маш. кода  | structured+binary  | structured          |        |      |
| Ввод-вывод               | SPI без прерываний | SPI прерывания      | слово  |      |
| Ввод-вывод (ISA)         | memory-mapped      | port-mapped         |        |      |
| Параллелизм              | SISD               | SISD                | SIMT   |      |
| Сторожевой таймер        | есть               | нет                 |        |      |

<!--
Возможные особенности:

- Кеширование при доступе к памяти.
-->

#### Требования к реализации

- рекомендуемый язык разработки: Python (иные варианты требуют предварительного согласования);
- помимо непосредственной реализации необходимо:
    - разработка unit-test-ов для всех компонент;
    - разработка тестов для заданных алгоритмов;
    - демонстрация реализации специфических требований;
    - ключевые тесты должны быть хорошо структурированы и читаемы.
- публикация кода на Github/Gitlab с настроенным CI (тесты, `mypy --strict`, проверка форматирования, проверка стиля кодирования, отчёт об уровне тестового покрытия);
- допускается использование шаблонов при настройке CI, при понимании его работы.

#### Открытые вопросы

- Чего хотим достичь:
    - гибкости для студентов -- студент выбирает
    - дать возможность сделать больше тем, кто хочет
    - что бы все что-то сделали руками
- Кто, как и когда будет проверять лаб 3.
- Кто, как и когда будет слушать лаб 1.

